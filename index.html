<!-- index.html - Client-Side Canary Deployment with Session-Based Assignment -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Client-Side Canary Deployment</title>
  <script>
    // Configuration
    const configUrl = 'config.json'; // Hosted on same GitHub Pages site
    const defaultVersion = 'default';
    const canaryVersion = 'canary';

    // Check sessionStorage for version assignment, if not assigned, assign one randomly
    function getVersionFromSession() {
      const version = sessionStorage.getItem('version');
      if (version) return version;
      // In a real-world scenario, you might want to use a more sophisticated method
      // to determine the version assignment, such as A/B testing or user segmentation.
      //
      // For simplicity, we are using a random assignment here.
      //
      // This is where you would fetch the config from the server if needed
      // fetch(configUrl)
      //   .then(response => response.json())
      //   .then(data => {
      //     // Use the data to determine the version assignment
      //   });
      //
      // For now, we will just randomly assign
      // the canary or default version at 50% for demonstration purposes.
      return Math.random() < 0.5 ? canaryVersion : defaultVersion;
    }

    function setVersionInSession(version) {
      sessionStorage.setItem('version', version);
    }

    async function init() {
      const version = getVersionFromSession();
      setVersionInSession(version);
      window.location.replace(`${version}/index.html`);
    }

    window.onload = init;
  </script>
</head>
<body>
  <h1>Redirecting...</h1>
</body>
</html>
